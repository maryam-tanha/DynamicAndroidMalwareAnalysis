import os
import subprocess
import re

def create_directories():
    directory_name_strace = "logs/strace"
    directory_name_monkey = "logs/monkey"
    output_file_strace = "strace_output.txt"
    output_file_monkey = "monkey_output.txt"

    # Get the root directory path
    root_directory = os.getcwd()

    # Create the directory path
    directory_path_strace = os.path.join(root_directory, directory_name_strace)
    directory_path_monkey = os.path.join(root_directory, directory_name_monkey)

    # Create the directory if it doesn't exist
    for i in range(2):
        if (i == 1):
            if not os.path.exists(directory_path_strace):
                os.makedirs(directory_path_strace)
        else:
            if not os.path.exists(directory_path_monkey):
                os.makedirs(directory_path_monkey)

    # Create the full output file path
    output_file_path_strace = os.path.join(
        directory_path_strace, output_file_strace)
    output_file_path_monkey = os.path.join(
        directory_path_monkey, output_file_monkey)
    return {output_file_path_monkey, output_file_path_strace}

def get_package_name(apk_path):
    # BASH CMD: `aapt dump badging <apk_path>`
    aapt_output = subprocess.check_output(
        ["aapt", "dump", "badging", apk_path]
    ).decode()
    package_name_match = re.search(r"package: name='([^']*)'", aapt_output)
    if package_name_match:
        return package_name_match.group(1)
    else:
        raise ValueError("Failed to retrieve package name from APK file.")
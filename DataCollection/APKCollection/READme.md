# Intructions on getting Android APKs

## Creating hash files for Androzoo APKs (Benign and Malware)

Upon navigating to this [lists page](https://androzoo.uni.lu/lists), you'll see a >2.7 GB compressed CSV file labeled <i>latest.csv.gz</i>. This file contains information on each APK present in the library.

The <b>sha256</b> column represents the unique primary key for each APK. Each row comprises the following column headers:  
'sha256', 'sha1', 'md5', 'apk_size', 'dex_size', 'dex_date', 'pkg_name', 'vercode', 'vt_detection', 'vt_scan_date', 'markets'

We downloaded this sizable compressed CSV file to filter the list, aiming to create a collection of sha256 keys associated with Goodware APKs categorized by year.

The [page](https://androzoo.uni.lu/lists) provides guidance on how to tailor the list according to our specific requirements. The example commands offered for "Filtering the List" were designed for the Linux OS and were not compatible with the Windows OS. To execute these commands, we installed WSL (Windows Subsystem for Linux) [WSL docs](https://learn.microsoft.com/en-us/windows/wsl/install) and utilized the Ubuntu OS.

For instance, the command below is utilized to generate a list of sha256 keys from the year 2022:  
```bash
zcat latest.csv.gz | grep -v ',snaggamea' | awk -F, '{if ($8 == 0 && $4 >= "2022-01-01" && $4 < "2023-01-01") {print $1} }' > benign_apks_2022.txt
```
**Note:** $8 == 0 in the above command, which ensures that vt_detection equals to 0 which means that no antivirus software detected the APK as a malware.

The output of the above command can be found here: [Goodware APKs 2022].

For Malware APKs, we set the vt_detection to be greater than 4 ($8 > 4).

The datasets created from above zcat commands can be found in the [APK Datasets] folder.

Now that we have created the dataset, we move on to downloading the datasets from AndroZoo.

## Downloading APKs from AndroZoo:

**get_apk_from_androzoo.py** allows you to download APK files from AndroZoo using a provided hash list and AndroZoo API key.

### Usage

#### Prerequisites

- Python 3.x
- Required Python packages (install using `pip install -r requirements.txt`):
  - `requests`
  - `tqdm`

#### Input Parameters

The script requires the following input parameters:

1. **api_key_file**: File containing the AndroZoo API key.
2. **hash_list_file**: File with a list of SHA256 hashes.
3. **output_dir**: Full path to the directory where downloaded APK files will be stored.

Optional parameter:

- **--num-workers**: Number of parallel processes to download APK files. Default is 40.

#### How to Obtain Input Parameters

1. **AndroZoo API Key**:
   - Obtain an API key from AndroZoo by registering on their [official website](https://androzoo.uni.lu/access).
   - Save the API key in a text file.

2. **Hash List File**:
   - Prepare a text file containing a list of SHA256 hashes, each on a new line.
   - More Information for this can be found in the above sections.

3. **Output Directory**:
   - Choose or create a directory where you want the downloaded APK files to be saved.

#### Running the Script

Execute the script using the following command:

```bash
python get_apk_from_androzoo.py <api_key_file> <hash_list_file> --num-workers <num_workers> <output_dir>
```

Replace `<api_key_file>`, `<hash_list_file>`, `<num_workers>`, and `<output_dir>` with the appropriate values.

## Example

```bash
python get_apk_from_androzoo.py androzoo_api_key.txt hash_list.txt --num-workers 30 ./output_apks
```

This command will download APK files using the specified AndroZoo API key, hash list, and output directory with 30 parallel workers.

## Note

- The script checks for the existence of downloaded files and their correctness using SHA256 hash values.
- If a file already exists with the correct hash, it skips the download for that file.
- If a file exists but has a different hash or is corrupted, it redownloads the file.

### Author

- **Original Author**: Tomás Concepción Miranda
- **Original Source**: [https://gitlab.inria.fr/cidre-public/dada/-/blob/master/get_apk_from_androzoo.py](https://gitlab.inria.fr/cidre-public/dada/-/blob/master/get_apk_from_androzoo.py)
- **Second Author**: [Arunab Singh](https://github.com/ArunabSingh)



## VirusShare Malware Downloads

We downloaded the Malware APKs directly from VirusShare using their [bittorent trackers] {http://tracker.virusshare.com:6969/index2.tmpl)

The following files were downloaded and used to extract Malware APKs from 2022:
VirusShare_Android_APK_2022-1.zip
VirusShare_Android_APK_2022-2.zip
VirusShare_Android_APK_2022-3.zip

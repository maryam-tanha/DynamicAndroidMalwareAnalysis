# Feature Extraction for Dynamic Analysis


## Introduction
The major feature that we focused in our dynamic analysis were **System Calls**.  
System calls refer to requests made by the application to the underlying operating system for various services or resources. 


To extract system calls from an APK, you typically need to employ dynamic analysis techniques, such as the following:

1. **Dynamic Analysis Tools:**
   - **Emulators or Virtual Machines:** Use Android emulators or virtual machines to run the APK in a controlled environment. Tools like Genymotion or the Android Emulator can be configured to capture system calls during execution.
   - **Instrumentation Tools:** Employ tools like Frida or Xposed framework to inject code into the running application. This allows you to monitor and log system calls in real-time.

2. **Strace or Similar Tools:**
   - Tools like `strace` on Linux or similar system call tracers can be utilized to monitor system calls made by a running process. However, deploying these tools on an Android device may require a rooted device or special configurations.

4. **Network Traffic Analysis:**
   - Analyze the network traffic generated by the APK. System calls related to network communication, such as HTTP requests, can be inferred from the network activity.


## Getting Started
1. Install all the required dependencies/libraries: `pip install -r requirements.txt`
2. Install `adb` and `aapt` using the [guide](https://www.xda-developers.com/install-adb-windows-macos-linux/)
3. Consider installing `genymotion` if you do not have a rooted android device. Genymotion can be downloaded from [here](https://docs.genymotion.com/desktop/Get_started/Requirements/)
4. Helpful guide to refer: [Sayfer - Termux](https://sayfer.io/blog/tracing-android-applications-with-termux-and-linux-utilities/) 
## How to add adb & aapt to the PATH
1. MacOS: 
    - Option 1: Already have Android SDK installed
        - On MacOS with default Android installation, the current `aapt` location is inside specific build-tools version. For build-tools 28.0.3, you will find it in the following path: `/Users/userName/Library/Android/sdk/build-tools/28.0.3`. To add it to the path, use: `export PATH=$PATH:/path/to/new/location`
    - Option2: Using Homebrew
        - `brew install android-platform-tools`
        - Start using adb, using: `adb devices`

2. Windows: Please visit [How-to-edit-add-path](https://www.nextofwindows.com/how-to-addedit-environment-variables-in-windows-7/) to see how to add path.
    - Paths should look like:
        - Platform Tools - `C:\Program Files\Android\sdk\platform-tools` 
        - Tools - `C:\Program Files\Android\sdk\tools`
    - aapt specifically is a Build Tool, so you'll want to add that directory as well. 
        - Build Tools - `C:\Program Files\Android\sdk\build-tools\18.1.0`

    > NOTE: For WSL users, please refer to `setup-scripts/wsl-setup.sh`

3. Linux: Please refer to the [guide](https://www.xda-developers.com/install-adb-windows-macos-linux/)

## Generating Trace for Android APKs
Once we complete all the prerequisites we move on to generating traces for our Android APKs

## APK Analysis Script - syscall_tracing

This script automates the analysis of Android APK files using the Android Debug Bridge (ADB) and related tools.

### pseudocode - system call trace - syscall_tracing.py
```
GenerateTrace(dir)
    open the android device
    using adb #Command shell utility in Android
    connect to the android device
    for each apk ﬁle in dir
        using aapt
            pkgName #get package name from apk ﬁle
        using adb
            install the apk ﬁle into device
            start the main activity of the application
            using package name 
                pid #process id of the running app
                if pid != null
                    apkFile #start strace(pid)
                    start adb monkey(package) for 2 mins
                        close the app
                        kill(strace)
                        extract logFile to local storage
                uninstall the apk
                
```

### Usage
1. Ensure that ADB, AAPT, and related tools are properly installed.
2. Connect to an Android emulator using `adb connect`.
3. Execute the script in a terminal: `python script_name.py`.
4. View analysis results in the specified output directories.

Note: Adjust paths and emulator settings as needed. The script provides insights into app behavior through user interaction simulation and system call tracing.

